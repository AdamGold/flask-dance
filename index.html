<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Flask-Dance by singingwolfboy</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Flask-Dance</h1>
        <p>Doing the OAuth dance with style using Flask, requests, and oauthlib.</p>

        <p class="view"><a href="https://github.com/singingwolfboy/flask-dance">View the Project on GitHub <small>singingwolfboy/flask-dance</small></a></p>


        <ul>
          <li><a href="https://github.com/singingwolfboy/flask-dance/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/singingwolfboy/flask-dance/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/singingwolfboy/flask-dance">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h1>

<p>Just the basics:</p>

<pre><code>$ pip install Flask-Dance
</code></pre>

<p>Or if you're planning on using the built-in <a href="http://www.sqlalchemy.org/">SQLAlchemy</a> support:</p>

<pre><code>$ pip install Flask-Dance[models]
</code></pre>

<h1>
<a name="quickstart" class="anchor" href="#quickstart"><span class="octicon octicon-link"></span></a>Quickstart</h1>

<p>For <a href="http://flask-dance.readthedocs.org/en/latest/contrib.html">a few popular OAuth providers</a>, Flask-Dance provides pre-set configurations. For
example, to authenticate with Github, just do the following:</p>

<div class="highlight highlight-python"><pre><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">url_for</span>
<span class="kn">from</span> <span class="nn">flask_dance.contrib.github</span> <span class="kn">import</span> <span class="n">make_github_blueprint</span><span class="p">,</span> <span class="n">github</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="s">"supersekrit"</span>
<span class="n">blueprint</span> <span class="o">=</span> <span class="n">make_github_blueprint</span><span class="p">(</span>
    <span class="n">client_id</span><span class="o">=</span><span class="s">"my-key-here"</span><span class="p">,</span>
    <span class="n">client_secret</span><span class="o">=</span><span class="s">"my-secret-here"</span><span class="p">,</span>
    <span class="n">redirect_to</span><span class="o">=</span><span class="s">"index"</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">register_blueprint</span><span class="p">(</span><span class="n">blueprint</span><span class="p">,</span> <span class="n">url_prefix</span><span class="o">=</span><span class="s">"/login"</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s">"/"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">github</span><span class="o">.</span><span class="n">authorized</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s">"github.login"</span><span class="p">))</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">github</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">"/user"</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">resp</span><span class="o">.</span><span class="n">ok</span>
    <span class="k">return</span> <span class="s">"You are @{login} on Github"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">login</span><span class="o">=</span><span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s">"login"</span><span class="p">])</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>

<p><strong>NOTE</strong>: For this example to work, you must first <a href="https://github.com/settings/applications/new">register an application on Github</a>
to get a <code>client_id</code> and <code>client_secret</code>. The application's authorization callback URL must be
<code>http://localhost:5000/login/github/authorized</code>. You'll also need to set the
<a href="http://oauthlib.readthedocs.org/en/latest/oauth2/security.html#envvar-OAUTHLIB_INSECURE_TRANSPORT"><code>OAUTHLIB_INSECURE_TRANSPORT</code></a> environment variable, so that oauthlib
allows you to use HTTP rather than HTTPS.</p>

<p>The <code>github</code> object is a <a href="http://flask.pocoo.org/docs/latest/quickstart/#context-locals">context local</a>, just like <code>flask.request</code>. That means
that you can import it in any Python file you want, and use it in the context
of an incoming HTTP request. If you've split your Flask app up into multiple
different files, feel free to import this object in any of your files, and use
it just like you would use the <a href="http://python-requests.org/"><code>requests</code></a> module.</p>

<p>You can also use Flask-Dance with any OAuth provider you'd like, not just the
pre-set configurations. <a href="http://flask-dance.readthedocs.org/en/latest/consumers.html">See the documentation for how to use other OAuth
providers.</a></p>

<h1>
<a name="token-storage" class="anchor" href="#token-storage"><span class="octicon octicon-link"></span></a>Token Storage</h1>

<p>By default, OAuth access tokens are stored in Flask's session object. This means
that if the user ever clears their browser cookies, they will have to go through
the OAuth flow again, which is not good. You're better off storing access tokens
in a database or some other persistent store. If you're using <a href="http://www.sqlalchemy.org/">SQLAlchemy</a>,
it's easy: just pass your database model and session to the blueprint.
Flask-Dance even comes with a mixin to help you define your database model,
and it works with User models, too!</p>

<div class="highlight highlight-python"><pre><span class="kn">from</span> <span class="nn">flask_sqlalchemy</span> <span class="kn">import</span> <span class="n">SQLAlchemy</span>
<span class="kn">from</span> <span class="nn">flask_dance.models</span> <span class="kn">import</span> <span class="n">OAuthConsumerMixin</span>

<span class="n">db</span> <span class="o">=</span> <span class="n">SQLAlchemy</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c"># ... other columns as needed</span>

<span class="k">class</span> <span class="nc">OAuth</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">OAuthConsumerMixin</span><span class="p">):</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">relationship</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>

<span class="c"># get_current_user() is a function that returns the current logged in user</span>
<span class="n">blueprint</span><span class="o">.</span><span class="n">set_token_storage_sqlalchemy</span><span class="p">(</span><span class="n">OAuth</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">get_current_user</span><span class="p">)</span>
</pre></div>

<p>Flask-Dance can seamlessly integrate with <a href="http://pythonhosted.org/Flask-SQLAlchemy/">Flask-SQLAlchemy</a> for database
integration, <a href="https://flask-login.readthedocs.org/">Flask-Login</a> for user management, and <a href="http://pythonhosted.org/Flask-Cache/">Flask-Cache</a> for caching.
However, none of these other extensions are required. You don't even have to
use <a href="http://www.sqlalchemy.org/">SQLAlchemy</a> at all; if you'd prefer to use a different storage system,
writing a custom integration is easy. <a href="http://flask-dance.readthedocs.org/en/latest/token-storage.html#custom-storage">See the documentation for how to
use other token storage systems.</a></p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/singingwolfboy">singingwolfboy</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>